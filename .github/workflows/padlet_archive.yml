name: Padletアーカイブ一括取得

on:
  schedule:
    # 毎時0分に実行
    - cron: '0 * * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-archives:
    runs-on: ubuntu-latest
    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v4

      - name: フォルダ作成とデータ取得
        run: |
          # 保存先のフォルダをまとめて作成
          mkdir -p archive/nyg archive/woolisbest archive/magurock archive/kiseikaijoiinkai

          # 待機時間を決定
          # 手動実行なら3秒、自動実行なら10秒
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            SLEEP_TIME=3
          else
            SLEEP_TIME=3
          fi
          
          echo "現在のモード: ${{ github.event_name }}"
          echo "待機時間を ${SLEEP_TIME}秒 に設定して取得を開始します..."


          # ==========================================
          # 1. nyg シリーズ
          # ==========================================
          
          # nyg/archive
          curl -L --compressed -o archive/nyg/archive.md "https://padlet.com/padlets/scvs0iw7tdatft21/exports/markdown.md"
          sleep $SLEEP_TIME
          
          # nyg/ssjc
          curl -L --compressed -o archive/nyg/ssjc.md "https://padlet.com/padlets/ybtryru0lgzpxp34/exports/markdown.md"
          sleep $SLEEP_TIME

          # nyg/portalworld
          curl -L --compressed -o archive/nyg/portalworld.md "https://padlet.com/padlets/lpiw7xio9gwnmxrd/exports/markdown.md"
          sleep $SLEEP_TIME

          # nyg/arashitaisaku
          curl -L --compressed -o archive/nyg/arashitaisaku.md "https://padlet.com/padlets/i0fd897smvjo0tvj/exports/markdown.md"
          sleep $SLEEP_TIME

          # nyg/games
          curl -L --compressed -o archive/nyg/games.md "https://padlet.com/padlets/4b9092979b4e6dlm/exports/markdown.md"
          sleep $SLEEP_TIME

          # nyg/ssjt2025
          curl -L --compressed -o archive/nyg/ssjt2025.md "https://padlet.com/padlets/hqm4zg0lw3smlc23/exports/markdown.md"
          sleep $SLEEP_TIME


          # ==========================================
          # 2. woolisbest シリーズ
          # ==========================================

          # woolisbest/lobby
          curl -L --compressed -o archive/woolisbest/lobby.md "https://padlet.com/padlets/99xq7bb7zjzcfzw0/exports/markdown.md"
          sleep $SLEEP_TIME

          # woolisbest/main
          curl -L --compressed -o archive/woolisbest/main.md "https://padlet.com/padlets/f46agi7nbsmz8boy/exports/markdown.md"
          sleep $SLEEP_TIME

          # woolisbest/proxy
          curl -L --compressed -o archive/woolisbest/proxy.md "https://padlet.com/padlets/wo6pj5yfmqsue2rh/exports/markdown.md"
          sleep $SLEEP_TIME


          # ==========================================
          # 3. magurock シリーズ
          # ==========================================

          # magurock/lobby
          curl -L --compressed -o archive/magurock/lobby.md "https://padlet.com/padlets/e9n4zhdx6ucfbaa4/exports/markdown.md"
          sleep $SLEEP_TIME

          # magurock/main
          curl -L --compressed -o archive/magurock/main.md "https://padlet.com/padlets/v7eblregk0t2eq0k/exports/markdown.md"
          sleep $SLEEP_TIME


          # ==========================================
          # 4. kiseikaijoiinkai シリーズ
          # ==========================================

          # kiseikaijoiinkai/lobby
          curl -L --compressed -o archive/kiseikaijoiinkai/lobby.md "https://padlet.com/padlets/5db70e80bto7rnxl/exports/markdown.md"
          sleep $SLEEP_TIME


          # ==========================================
          # 5. その他の単独ファイル（アルファベット順）
          # ==========================================

          # beruri
          curl -L --compressed -o archive/beruri.md "https://padlet.com/padlets/zsdegt1d6scuq9qa/exports/markdown.md"
          sleep $SLEEP_TIME

          # bonjour
          curl -L --compressed -o archive/bonjour.md "https://padlet.com/padlets/fj7pwrjfd44519fq/exports/markdown.md"
          sleep $SLEEP_TIME

          # hikari
          curl -L --compressed -o archive/hikari.md "https://padlet.com/padlets/afg5jcs1w4yyk2h1/exports/markdown.md"
          sleep $SLEEP_TIME
          
          # itrsa
          curl -L --compressed -o archive/itrsa.md "https://padlet.com/padlets/kulz2hpe9vtrxep4/exports/markdown.md"
          sleep $SLEEP_TIME

          # kabotya
          curl -L --compressed -o archive/kabotya.md "https://padlet.com/padlets/34b6kq9lghbe3rtm/exports/markdown.md"
          sleep $SLEEP_TIME

          # obungu
          curl -L --compressed -o archive/obungu.md "https://padlet.com/padlets/5ggicyna1yjvquxr/exports/markdown.md"


      - name: まとめて保存
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          
          # archiveフォルダ全体を追加
          git add archive/
          
          if git diff --staged --quiet; then
            echo "変更がなかったので保存しません"
          else
            git commit -m "アーカイブデータを一括更新"
            git pull origin main --rebase
            git push
          fi
